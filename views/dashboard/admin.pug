extends ../layout/layout

block content
  //- Dashboard Header
  .mb-8
    h1.text-3xl.font-bold.text-gray-900 Admin Dashboard
    p.text-gray-600.mt-2 Welcome back! Here's an overview of your support system.
  
  //- Statistics Cards
  .grid.grid-cols-1.md_grid-cols-2.lg_grid-cols-4.gap-6.mb-8
    //- Total Tickets
    .bg-white.rounded-xl.shadow-sm.p-6.border.border-gray-200.hover_shadow-md.transition-shadow
      .flex.items-center.justify-between
        div
          p.text-sm.font-medium.text-gray-600 Total Tickets
          p.text-3xl.font-bold.text-gray-900.mt-2= ticketStats.total_tickets || 0
        .w-12.h-12.bg-indigo-100.rounded-lg.flex.items-center.justify-center
          i.lucide.lucide-ticket.text-indigo-600.w-6.h-6(data-lucide="ticket")
    
    //- Open Tickets
    .bg-white.rounded-xl.shadow-sm.p-6.border.border-gray-200.hover_shadow-md.transition-shadow
      .flex.items-center.justify-between
        div
          p.text-sm.font-medium.text-gray-600 Open Tickets
          p.text-3xl.font-bold.text-orange-600.mt-2= ticketStats.open_tickets || 0
        .w-12.h-12.bg-orange-100.rounded-lg.flex.items-center.justify-center
          i.lucide.lucide-alert-circle.text-orange-600.w-6.h-6(data-lucide="alert-circle")
    
    //- Resolved Today
    .bg-white.rounded-xl.shadow-sm.p-6.border.border-gray-200.hover_shadow-md.transition-shadow
      .flex.items-center.justify-between
        div
          p.text-sm.font-medium.text-gray-600 Resolved
          p.text-3xl.font-bold.text-green-600.mt-2= ticketStats.resolved_tickets || 0
        .w-12.h-12.bg-green-100.rounded-lg.flex.items-center.justify-center
          i.lucide.lucide-check-circle.text-green-600.w-6.h-6(data-lucide="check-circle")
    
    //- Active Users
    .bg-white.rounded-xl.shadow-sm.p-6.border.border-gray-200.hover_shadow-md.transition-shadow
      .flex.items-center.justify-between
        div
          p.text-sm.font-medium.text-gray-600 Active Users
          p.text-3xl.font-bold.text-blue-600.mt-2= userStats.active_users || 0
        .w-12.h-12.bg-blue-100.rounded-lg.flex.items-center.justify-center
          i.lucide.lucide-users.text-blue-600.w-6.h-6(data-lucide="users")
  
  .grid.grid-cols-1.lg_grid-cols-2.gap-6.mb-8
    //- Tickets by Status Chart
    .bg-white.rounded-xl.shadow-sm.p-6.border.border-gray-200
      h3.text-lg.font-semibold.text-gray-900.mb-4 Tickets by Status
      .space-y-3
        //- Open
        div
          .flex.justify-between.mb-2
            span.text-sm.font-medium.text-gray-700 Open
            span.text-sm.font-semibold.text-gray-900= ticketStats.open_tickets || 0
          .w-full.bg-gray-200.rounded-full.h-2
            .bg-orange-500.h-2.rounded-full(style=`width: ${ticketStats.total_tickets > 0 ? (ticketStats.open_tickets / ticketStats.total_tickets * 100) : 0}%`)
        
        //- In Progress
        div
          .flex.justify-between.mb-2
            span.text-sm.font-medium.text-gray-700 In Progress
            span.text-sm.font-semibold.text-gray-900= ticketStats.in_progress_tickets || 0
          .w-full.bg-gray-200.rounded-full.h-2
            .bg-blue-500.h-2.rounded-full(style=`width: ${ticketStats.total_tickets > 0 ? (ticketStats.in_progress_tickets / ticketStats.total_tickets * 100) : 0}%`)
        
        //- Resolved
        div
          .flex.justify-between.mb-2
            span.text-sm.font-medium.text-gray-700 Resolved
            span.text-sm.font-semibold.text-gray-900= ticketStats.resolved_tickets || 0
          .w-full.bg-gray-200.rounded-full.h-2
            .bg-green-500.h-2.rounded-full(style=`width: ${ticketStats.total_tickets > 0 ? (ticketStats.resolved_tickets / ticketStats.total_tickets * 100) : 0}%`)
        
        //- Closed
        div
          .flex.justify-between.mb-2
            span.text-sm.font-medium.text-gray-700 Closed
            span.text-sm.font-semibold.text-gray-900= ticketStats.closed_tickets || 0
          .w-full.bg-gray-200.rounded-full.h-2
            .bg-gray-500.h-2.rounded-full(style=`width: ${ticketStats.total_tickets > 0 ? (ticketStats.closed_tickets / ticketStats.total_tickets * 100) : 0}%`)
    
    //- Tickets by Priority
    .bg-white.rounded-xl.shadow-sm.p-6.border.border-gray-200
      h3.text-lg.font-semibold.text-gray-900.mb-4 Tickets by Priority
      .grid.grid-cols-2.gap-4
        .bg-red-50.rounded-lg.p-4.border.border-red-200
          .flex.items-center.justify-between
            div
              p.text-xs.font-medium.text-red-600 Critical
              p.text-2xl.font-bold.text-red-700.mt-1= ticketStats.critical_tickets || 0
            i.lucide.lucide-alert-triangle.text-red-500.w-8.h-8(data-lucide="alert-triangle")
        
        .bg-orange-50.rounded-lg.p-4.border.border-orange-200
          .flex.items-center.justify-between
            div
              p.text-xs.font-medium.text-orange-600 High
              p.text-2xl.font-bold.text-orange-700.mt-1= ticketStats.high_tickets || 0
            i.lucide.lucide-arrow-up.text-orange-500.w-8.h-8(data-lucide="arrow-up")
        
        .bg-yellow-50.rounded-lg.p-4.border.border-yellow-200
          .flex.items-center.justify-between
            div
              p.text-xs.font-medium.text-yellow-600 Medium
              p.text-2xl.font-bold.text-yellow-700.mt-1= ticketStats.medium_tickets || 0
            i.lucide.lucide-minus.text-yellow-500.w-8.h-8(data-lucide="minus")
        
        .bg-green-50.rounded-lg.p-4.border.border-green-200
          .flex.items-center.justify-between
            div
              p.text-xs.font-medium.text-green-600 Low
              p.text-2xl.font-bold.text-green-700.mt-1= ticketStats.low_tickets || 0
            i.lucide.lucide-arrow-down.text-green-500.w-8.h-8(data-lucide="arrow-down")
  
  //- Recent Tickets and Activity
  .grid.grid-cols-1.lg_grid-cols-2.gap-6
    //- Recent Tickets
    .bg-white.rounded-xl.shadow-sm.p-6.border.border-gray-200
      .flex.items-center.justify-between.mb-4
        h3.text-lg.font-semibold.text-gray-900 Recent Tickets
        a.text-sm.font-medium.text-indigo-600.hover_text-indigo-700(href="/tickets") View all
      
      .space-y-3
        if recentTickets && recentTickets.length > 0
          each ticket in recentTickets
            a.block.p-4.bg-gray-50.rounded-lg.hover_bg-gray-100.transition-colors(href=`/tickets/${ticket.id}`)
              .flex.items-start.justify-between
                div.flex-1
                  p.text-sm.font-semibold.text-gray-900= ticket.subject
                  p.text-xs.text-gray-600.mt-1= ticket.customer_name
                  .flex.items-center.mt-2.space-x-2
                    case ticket.priority
                      when 'critical'
                        span.px-2.py-1.text-xs.font-medium.bg-red-100.text-red-700.rounded-full Critical
                      when 'high'
                        span.px-2.py-1.text-xs.font-medium.bg-orange-100.text-orange-700.rounded-full High
                      when 'medium'
                        span.px-2.py-1.text-xs.font-medium.bg-yellow-100.text-yellow-700.rounded-full Medium
                      default
                        span.px-2.py-1.text-xs.font-medium.bg-green-100.text-green-700.rounded-full Low
                    case ticket.status
                      when 'open'
                        span.px-2.py-1.text-xs.font-medium.bg-orange-100.text-orange-700.rounded-full Open
                      when 'in_progress'
                        span.px-2.py-1.text-xs.font-medium.bg-blue-100.text-blue-700.rounded-full In Progress
                      when 'resolved'
                        span.px-2.py-1.text-xs.font-medium.bg-green-100.text-green-700.rounded-full Resolved
                      default
                        span.px-2.py-1.text-xs.font-medium.bg-gray-100.text-gray-700.rounded-full= ticket.status
                span.text-xs.text-gray-500 #{ticket.ticket_number}
        else
          p.text-sm.text-gray-500.text-center.py-8 No recent tickets
    
    //- Recent Activity
    .bg-white.rounded-xl.shadow-sm.p-6.border.border-gray-200
      h3.text-lg.font-semibold.text-gray-900.mb-4 Recent Activity
      .space-y-4
        if recentActivity && recentActivity.length > 0
          each activity in recentActivity
            .flex.items-start.space-x-3
              .w-8.h-8.bg-indigo-100.rounded-full.flex.items-center.justify-center.flex-shrink-0
                i.lucide.lucide-activity.text-indigo-600.w-4.h-4(data-lucide="activity")
              div.flex-1.min-w-0
                p.text-sm.text-gray-900= activity.description
                p.text-xs.text-gray-500.mt-1= activity.user_name
              p.text-xs.text-gray-400.flex-shrink-0 Just now
        else
          p.text-sm.text-gray-500.text-center.py-8 No recent activity

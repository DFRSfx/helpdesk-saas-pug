//- Reusable Confirmation Modal - SaaS Style
//- Usage: include ./partials/modal
//- Then call: openModal('Title', 'Message', 'Confirm Text', callbackFunction, 'danger' or 'warning')

style.
  @keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes modalScaleIn {
    from { transform: scale(0.92); }
    to { transform: scale(1); }
  }
  @keyframes modalFadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
  }
  @keyframes modalScaleOut {
    from { transform: scale(1); }
    to { transform: scale(0.92); }
  }

  #confirmModal.show-modal {
    animation: modalFadeIn 0.15s ease-out forwards !important;
  }
  #confirmModal #modalContent.show-modal {
    animation: modalScaleIn 0.15s ease-out forwards !important;
  }
  #confirmModal.hide-modal {
    animation: modalFadeOut 0.12s ease-in forwards !important;
  }
  #confirmModal #modalContent.hide-modal {
    animation: modalScaleOut 0.12s ease-in forwards !important;
  }

#confirmModal.fixed.inset-0.hidden.z-50.flex.items-center.justify-center(
  style="background: rgba(0, 0, 0, 0.4);"
)
  .bg-white.rounded-xl.overflow-hidden(
    id="modalContent"
    style="width: 100%; max-width: 28rem; margin: 1rem; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);"
  )
    //- Icon + Header
    .px-6.pt-6
      .flex.items-start.gap-4
        .w-12.h-12.rounded-full.flex.items-center.justify-center.flex-shrink-0(
          id="modalIcon"
          style="background: rgba(220, 38, 38, 0.1);"
        )
          svg.w-6.h-6.text-red-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4v2m0 4v2m0-14a9 9 0 110 18 9 9 0 010-18z")

        div.flex-1
          h3.text-lg.font-semibold.text-gray-900#modalTitle
          p.text-sm.text-gray-600.mt-1#modalMessage

    //- Footer
    .flex.gap-3.px-6.py-4.mt-2.border-t.border-gray-100.justify-end
      button.px-4.py-2.rounded-lg.font-medium.text-gray-700.transition-all.duration-200(
        type="button"
        onclick="closeModal()"
        style="background: #f3f4f6; border: 1px solid transparent;"
        onmouseover="this.style.background='#e5e7eb'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.08)';"
        onmouseout="this.style.background='#f3f4f6'; this.style.boxShadow='none';"
      )
        | Cancel
      button.px-4.py-2.rounded-lg.font-medium.text-white.transition-all.duration-200(
        type="button"
        id="modalConfirmBtn"
        onclick="confirmAction()"
        style="background: linear-gradient(135deg, #dc2626, #b91c1c); box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);"
        onmouseover="this.style.boxShadow='0 8px 20px rgba(220, 38, 38, 0.4)'; this.style.transform='translateY(-2px)';"
        onmouseout="this.style.boxShadow='0 4px 12px rgba(220, 38, 38, 0.3)'; this.style.transform='translateY(0)';"
      )
        | Confirm

block scripts
  script.
    let modalCallback = null;
    let modalElement = null;
    let isAnimating = false;

    function openModal(title, message, confirmText = 'Confirm', callback, type = 'danger') {
      if (isAnimating) return;

      modalElement = document.getElementById('confirmModal');
      const modalContent = document.getElementById('modalContent');
      const modalTitle = document.getElementById('modalTitle');
      const modalMessage = document.getElementById('modalMessage');
      const modalConfirmBtn = document.getElementById('modalConfirmBtn');
      const modalIcon = document.getElementById('modalIcon');

      modalTitle.textContent = title;
      modalMessage.textContent = message;
      modalConfirmBtn.textContent = confirmText;
      modalCallback = callback;

      // Update icon and colors based on type
      const typeConfig = {
        danger: {
          iconBg: 'rgba(220, 38, 38, 0.1)',
          iconColor: '#dc2626',
          buttonGradient: 'linear-gradient(135deg, #dc2626, #b91c1c)',
          buttonShadow: 'rgba(220, 38, 38, 0.3)',
          icon: 'M12 9v2m0 4v2m0 4v2m0-14a9 9 0 110 18 9 9 0 010-18z'
        },
        warning: {
          iconBg: 'rgba(239, 68, 68, 0.1)',
          iconColor: '#ef4444',
          buttonGradient: 'linear-gradient(135deg, #f97316, #ea580c)',
          buttonShadow: 'rgba(249, 115, 22, 0.3)',
          icon: 'M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'
        },
        success: {
          iconBg: 'rgba(34, 197, 94, 0.1)',
          iconColor: '#22c55e',
          buttonGradient: 'linear-gradient(135deg, #22c55e, #16a34a)',
          buttonShadow: 'rgba(34, 197, 94, 0.3)',
          icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'
        }
      };

      const config = typeConfig[type] || typeConfig.danger;

      modalIcon.style.background = config.iconBg;
      modalIcon.querySelector('svg').style.color = config.iconColor;
      modalIcon.querySelector('path').setAttribute('d', config.icon);
      modalConfirmBtn.style.background = config.buttonGradient;
      modalConfirmBtn.style.boxShadow = `0 4px 12px ${config.buttonShadow}`;

      // Update hover states
      modalConfirmBtn.onmouseover = function() {
        this.style.boxShadow = `0 8px 20px ${config.buttonShadow}`;
        this.style.transform = 'translateY(-2px)';
      };
      modalConfirmBtn.onmouseout = function() {
        this.style.boxShadow = `0 4px 12px ${config.buttonShadow}`;
        this.style.transform = 'translateY(0)';
      };

      // Show modal with animation
      isAnimating = true;
      modalElement.classList.remove('hidden', 'hide-modal');
      modalContent.classList.remove('hide-modal');

      requestAnimationFrame(() => {
        modalElement.classList.add('show-modal');
        modalContent.classList.add('show-modal');
      });

      setTimeout(() => {
        isAnimating = false;
      }, 150);
    }

    function closeModal() {
      if (!modalElement || isAnimating) return;

      const modalContent = document.getElementById('modalContent');
      isAnimating = true;

      modalElement.classList.remove('show-modal');
      modalContent.classList.remove('show-modal');
      modalElement.classList.add('hide-modal');
      modalContent.classList.add('hide-modal');

      setTimeout(() => {
        modalElement.classList.add('hidden');
        modalCallback = null;
        isAnimating = false;
      }, 120);
    }

    function confirmAction() {
      if (modalCallback && typeof modalCallback === 'function') {
        modalCallback();
      }
      closeModal();
    }

    // Close modal on background click
    document.addEventListener('click', function(e) {
      if (e.target === document.getElementById('confirmModal')) {
        closeModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && modalElement && !modalElement.classList.contains('hidden')) {
        closeModal();
      }
    });

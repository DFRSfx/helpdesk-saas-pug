extends ../layout/layout

block content
  .max-w-7xl.mx-auto.py-6

    //- Page Header
    h1.text-3xl.font-bold.text-gray-900.dark_text-white.mb-6 SLA Dashboard

    //- Key Metrics
    .grid.grid-cols-1.md_grid-cols-4.gap-4.mb-6

      //- Total Tickets
      .bg-white.dark_bg-neutral-800.rounded-lg.shadow-sm.border.border-gray-200.dark_border-neutral-700.p-6
        .flex.items-center.justify-between
          div
            p.text-sm.font-medium.text-gray-600.dark_text-neutral-400 Total Tickets
            p.text-3xl.font-bold.text-gray-900.dark_text-white= stats.total_tickets

          svg.w-12.h-12.text-blue-600.opacity-20(fill="currentColor" viewBox="0 0 24 24")
            path(d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2")

      //- Response Compliance
      .bg-white.dark_bg-neutral-800.rounded-lg.shadow-sm.border.border-gray-200.dark_border-neutral-700.p-6
        .flex.items-center.justify-between
          div
            p.text-sm.font-medium.text-gray-600.dark_text-neutral-400 Response Compliance
            p.text-3xl.font-bold(class=stats.response_breach_rate > 20 ? 'text-red-600' : 'text-green-600')
              = (100 - stats.response_breach_rate).toFixed(1)
              span.text-lg %
            p.text-xs.text-gray-500.dark_text-neutral-400.mt-1
              = stats.response_breached
              span  breaches

          svg.w-12.h-12(class=stats.response_breach_rate > 20 ? 'text-red-600' : 'text-green-600', fill="currentColor" opacity="0.2" viewBox="0 0 24 24")
            path(d="M9 12l2 2 4-4M7 20H5a2 2 0 01-2-2V7a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2h-5m-4 0h6m-6 0v3")

      //- Resolution Compliance
      .bg-white.dark_bg-neutral-800.rounded-lg.shadow-sm.border.border-gray-200.dark_border-neutral-700.p-6
        .flex.items-center.justify-between
          div
            p.text-sm.font-medium.text-gray-600.dark_text-neutral-400 Resolution Compliance
            p.text-3xl.font-bold(class=stats.resolution_breach_rate > 15 ? 'text-red-600' : 'text-green-600')
              = (100 - stats.resolution_breach_rate).toFixed(1)
              span.text-lg %
            p.text-xs.text-gray-500.dark_text-neutral-400.mt-1
              = stats.resolution_breached
              span  breaches

          svg.w-12.h-12(class=stats.resolution_breach_rate > 15 ? 'text-red-600' : 'text-green-600', fill="currentColor" opacity="0.2" viewBox="0 0 24 24")
            path(d="M13 10V3L4 14h7v7l9-11h-7z")

      //- Resolved Tickets
      .bg-white.dark_bg-neutral-800.rounded-lg.shadow-sm.border.border-gray-200.dark_border-neutral-700.p-6
        .flex.items-center.justify-between
          div
            p.text-sm.font-medium.text-gray-600.dark_text-neutral-400 Resolved Tickets
            p.text-3xl.font-bold.text-gray-900.dark_text-white= stats.resolved_tickets
            if stats.total_tickets > 0
              p.text-xs.text-gray-500.dark_text-neutral-400.mt-1
                = ((stats.resolved_tickets / stats.total_tickets) * 100).toFixed(1)
                span % of total

          svg.w-12.h-12.text-green-600.opacity-20(fill="currentColor" viewBox="0 0 24 24")
            path(d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z")

    //- Tickets at Risk
    if atRisk && atRisk.length > 0
      .bg-white.dark_bg-neutral-800.rounded-lg.shadow-sm.border.border-red-200.dark_border-red-900/30.mb-6

        .p-6.border-b.border-gray-200.dark_border-neutral-700
          .flex.items-center.gap-2
            svg.w-6.h-6.text-red-600(fill="currentColor" viewBox="0 0 24 24")
              path(d="M12 9v2m0 4v2m0-12a9 9 0 110 18 9 9 0 010-18z")
            h2.text-lg.font-semibold.text-red-600 Tickets At Risk of SLA Breach

        .overflow-x-auto
          table.w-full.text-sm
            thead
              tr.bg-red-50.dark_bg-red-900/10.border-b.border-gray-200.dark_border-neutral-700
                th.px-6.py-3.text-left.font-semibold.text-gray-700.dark_text-neutral-300 Ticket
                th.px-6.py-3.text-left.font-semibold.text-gray-700.dark_text-neutral-300 Department
                th.px-6.py-3.text-left.font-semibold.text-gray-700.dark_text-neutral-300 Agent
                th.px-6.py-3.text-center.font-semibold.text-gray-700.dark_text-neutral-300 Priority
                th.px-6.py-3.text-center.font-semibold.text-gray-700.dark_text-neutral-300 Risk Type
                th.px-6.py-3.text-right.font-semibold.text-gray-700.dark_text-neutral-300 Due

            tbody
              each ticket in atRisk
                tr.border-b.border-gray-200.dark_border-neutral-700.hover_bg-red-50.dark_hover_bg-red-900/10.transition-colors
                  td.px-6.py-4
                    a.text-blue-600.hover_text-blue-800.dark_text-blue-400.dark_hover_text-blue-300.font-medium(href=`/tickets/${ticket.id}`)
                      = ticket.title
                  td.px-6.py-4.text-gray-700.dark_text-neutral-300= ticket.department_name || '-'
                  td.px-6.py-4.text-gray-700.dark_text-neutral-300= ticket.agent_name || 'Unassigned'

                  td.px-6.py-4.text-center
                    span(class={
                      'Critical': 'px-3 py-1 bg-red-100 dark_bg-red-900/30 text-red-800 dark_text-red-300 rounded-full text-xs font-semibold',
                      'High': 'px-3 py-1 bg-orange-100 dark_bg-orange-900/30 text-orange-800 dark_text-orange-300 rounded-full text-xs font-semibold',
                      'Medium': 'px-3 py-1 bg-yellow-100 dark_bg-yellow-900/30 text-yellow-800 dark_text-yellow-300 rounded-full text-xs font-semibold',
                      'Low': 'px-3 py-1 bg-green-100 dark_bg-green-900/30 text-green-800 dark_text-green-300 rounded-full text-xs font-semibold'
                    }[ticket.priority])= ticket.priority

                  td.px-6.py-4.text-center
                    if ticket.response_at_risk
                      span.px-3.py-1.bg-orange-100.dark_bg-orange-900/30.text-orange-800.dark_text-orange-300.rounded-full.text-xs.font-semibold Response
                    else if ticket.resolution_at_risk
                      span.px-3.py-1.bg-red-100.dark_bg-red-900/30.text-red-800.dark_text-red-300.rounded-full.text-xs.font-semibold Resolution

                  td.px-6.py-4.text-right.text-sm.text-gray-700.dark_text-neutral-300
                    if ticket.sla_response_due && ticket.response_at_risk
                      = new Date(ticket.sla_response_due).toLocaleString()
                    else if ticket.sla_resolution_due
                      = new Date(ticket.sla_resolution_due).toLocaleString()
    else
      .bg-green-50.dark_bg-green-900/10.rounded-lg.border.border-green-200.dark_border-green-900/30.p-6.mb-6
        .flex.items-center.gap-3
          svg.w-6.h-6.text-green-600(fill="currentColor" viewBox="0 0 24 24")
            path(d="M9 12l2 2 4-4m7 0a9 9 0 11-18 0 9 9 0 0118 0z")
          p.text-green-800.dark_text-green-200.font-medium All tickets are on track! No SLA breaches at risk.

    //- Compliance Report by Department
    .bg-white.dark_bg-neutral-800.rounded-lg.shadow-sm.border.border-gray-200.dark_border-neutral-700

      .p-6.border-b.border-gray-200.dark_border-neutral-700
        h2.text-lg.font-semibold.text-gray-900.dark_text-white SLA Compliance by Department (Last 30 Days)

      .overflow-x-auto
        table.w-full.text-sm
          thead
            tr.bg-gray-50.dark_bg-neutral-700/50.border-b.border-gray-200.dark_border-neutral-700
              th.px-6.py-3.text-left.font-semibold.text-gray-700.dark_text-neutral-300 Department
              th.px-6.py-3.text-center.font-semibold.text-gray-700.dark_text-neutral-300 Tickets
              th.px-6.py-3.text-center.font-semibold.text-gray-700.dark_text-neutral-300 Response Breaches
              th.px-6.py-3.text-center.font-semibold.text-gray-700.dark_text-neutral-300 Response Compliance
              th.px-6.py-3.text-center.font-semibold.text-gray-700.dark_text-neutral-300 Avg Response
              th.px-6.py-3.text-right.font-semibold.text-gray-700.dark_text-neutral-300 Trend

          tbody
            if complianceReport && complianceReport.length > 0
              each dept in complianceReport
                tr.border-b.border-gray-200.dark_border-neutral-700.hover_bg-gray-50.dark_hover_bg-neutral-700/50.transition-colors
                  td.px-6.py-4.font-medium.text-gray-900.dark_text-white= dept.name || 'Unknown'
                  td.px-6.py-4.text-center.text-gray-700.dark_text-neutral-300= dept.total_tickets

                  td.px-6.py-4.text-center
                    span(class=dept.response_breached > 0 ? 'text-red-600 font-semibold' : 'text-green-600 font-semibold')
                      = dept.response_breached || 0

                  td.px-6.py-4.text-center
                    .flex.items-center.justify-center.gap-2
                      .w-16.bg-gray-200.dark_bg-neutral-700.rounded-full.h-2(style=`background: linear-gradient(to right, #10b981 0%, #10b981 ${dept.response_compliance_rate}%, #ef4444 ${dept.response_compliance_rate}%);`)
                      span(class=parseFloat(dept.response_compliance_rate) >= 95 ? 'text-green-600 font-semibold' : 'text-orange-600 font-semibold')
                        = dept.response_compliance_rate
                        span %

                  td.px-6.py-4.text-center.text-gray-700.dark_text-neutral-300
                    = dept.avg_response_time_hours ? dept.avg_response_time_hours.toFixed(1) : '-'
                    span.text-gray-500.dark_text-neutral-400.text-xs hours

                  td.px-6.py-4.text-right
                    if dept.response_breached > 0
                      svg.w-5.h-5.text-red-600(fill="currentColor" viewBox="0 0 24 24")
                        path(d="M12 19l9-8-9-8-9 8 9 8zm0-4l6-5-6-5-6 5 6 5z")
                    else
                      svg.w-5.h-5.text-green-600(fill="currentColor" viewBox="0 0 24 24")
                        path(d="M12 19l9-8-9-8-9 8 9 8zm0-4l-6-5 6-5 6-5-6 5z")
            else
              tr
                td.px-6.py-4.text-center.text-gray-500.dark_text-neutral-400(colspan="6")
                  p No compliance data available yet.

  script.
    // Chart.js could be integrated here for visualizations
    // For now, we show the data in tables

extends ../layout/layout

block content
  .max-w-3xl.mx-auto
    .bg-white.rounded-lg.shadow-sm.border.border-gray-200.p-6
      h2.text-2xl.font-bold.text-gray-900.mb-6 Create New User

      form(action="/users" method="POST")
        .space-y-6
          //- Name
          div
            label.block.text-sm.font-medium.text-gray-700.mb-2(for="name")
              | Full Name
              span.text-red-500 *
            input#name.w-full.px-4.py-2.border.border-gray-300.rounded-lg.focus_outline-none.focus_ring-2.focus_ring-blue-500(
              type="text"
              name="name"
              required
              placeholder="John Doe"
            )

          //- Email
          div
            label.block.text-sm.font-medium.text-gray-700.mb-2(for="email")
              | Email Address
              span.text-red-500 *
            input#email.w-full.px-4.py-2.border.border-gray-300.rounded-lg.focus_outline-none.focus_ring-2.focus_ring-blue-500(
              type="email"
              name="email"
              required
              placeholder="john.doe@example.com"
            )

          .grid.grid-cols-1.md_grid-cols-2.gap-6
            //- Password
            div
              label.block.text-sm.font-medium.text-gray-700.mb-2(for="password")
                | Password
                span.text-red-500 *
              input#password.w-full.px-4.py-2.border.border-gray-300.rounded-lg.focus_outline-none.focus_ring-2.focus_ring-blue-500(
                type="password"
                name="password"
                required
                minlength="6"
                placeholder="At least 6 characters"
              )
              p.mt-1.text-xs.text-gray-500 Minimum 6 characters

            //- Confirm Password
            div
              label.block.text-sm.font-medium.text-gray-700.mb-2(for="confirm_password")
                | Confirm Password
                span.text-red-500 *
              input#confirm_password.w-full.px-4.py-2.border.border-gray-300.rounded-lg.focus_outline-none.focus_ring-2.focus_ring-blue-500(
                type="password"
                name="confirm_password"
                required
                minlength="6"
                placeholder="Re-enter password"
              )

          .grid.grid-cols-1.md_grid-cols-2.gap-6
            //- Role
            div
              label.block.text-sm.font-medium.text-gray-700.mb-2(for="role")
                | Role
                span.text-red-500 *
              select#role.w-full.px-4.py-2.border.border-gray-300.rounded-lg.focus_outline-none.focus_ring-2.focus_ring-blue-500(
                name="role"
                required
              )
                option(value="" disabled selected) Select a role
                option(value="customer") Customer
                option(value="agent") Agent
                option(value="admin") Administrator

            //- Department
            div
              label.block.text-sm.font-medium.text-gray-700.mb-2(for="department_id")
                | Department
                span.text-gray-500.text-xs.font-normal (Optional - for Agents/Admins)
              select#department_id.w-full.px-4.py-2.border.border-gray-300.rounded-lg.focus_outline-none.focus_ring-2.focus_ring-blue-500(
                name="department_id"
              )
                option(value="") None
                if departments && departments.length > 0
                  each dept in departments
                    option(value=dept.id)= dept.name

          //- Status
          div
            label.flex.items-center
              input#is_active.mr-2(type="checkbox" name="is_active" value="true" checked)
              span.text-sm.text-gray-700 Active (User can login)

          //- Submit buttons
          .flex.items-center.justify-end.space-x-4.pt-6.border-t.border-gray-200
            a.px-6.py-2.border.border-gray-300.text-gray-700.rounded-lg.hover_bg-gray-50.transition-colors(href="/users")
              | Cancel
            button.px-6.py-2.bg-blue-600.text-white.rounded-lg.hover_bg-blue-700.transition-colors(type="submit")
              | Create User

block scripts
  script.
    // Password validation
    const form = document.querySelector('form');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');

    form.addEventListener('submit', function(e) {
      if (password.value !== confirmPassword.value) {
        e.preventDefault();
        alert('Passwords do not match!');
        confirmPassword.focus();
        return false;
      }
    });

    // Real-time password match indicator
    confirmPassword.addEventListener('input', function() {
      if (this.value === password.value && this.value.length > 0) {
        this.classList.remove('border-red-300');
        this.classList.add('border-green-300');
      } else if (this.value.length > 0) {
        this.classList.remove('border-green-300');
        this.classList.add('border-red-300');
      } else {
        this.classList.remove('border-green-300', 'border-red-300');
      }
    });

    // Show/hide department based on role
    const roleSelect = document.getElementById('role');
    const deptDiv = document.getElementById('department_id').parentElement;

    roleSelect.addEventListener('change', function() {
      if (this.value === 'customer') {
        deptDiv.style.opacity = '0.5';
        document.getElementById('department_id').value = '';
      } else {
        deptDiv.style.opacity = '1';
      }
    });
